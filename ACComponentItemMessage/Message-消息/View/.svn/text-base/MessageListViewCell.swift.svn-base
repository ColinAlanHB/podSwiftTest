//
//  MessageListViewCell.swift
//  citizencloud
//
//  Created by 沈移动 on 2018/4/11.
//  Copyright © 2018年 linewell. All rights reserved.
//

import Foundation
import SnapKit
import ACComponentItemLib

// 消息列表
class MessageListViewCell : UITableViewCell {
    
    var model: UserNotifyMessageListDTO? {
        didSet {
            if let showTime = self.model?.createTimeStr {
                timeLabel.text = "  \(showTime)  "
            }
            titleLabel.text = self.model?.title ?? ""
            contentLabel.text = self.model?.summary ?? ""
            
            // 封面图片
            if model?.coverPicUrl != nil && model?.coverPicUrl != "" {
                // 封面
                let url = URL(string: INNOOssTool.instance.buildResizeUrl(model?.coverPicUrl ?? "", width: 720, height: 405))
                coverImage.sd_setImage(with: url, placeholderImage: DEFAULT_BG_16_9)
                
                // 更新高度
                coverImage.snp.updateConstraints { (make) in
                    make.height.equalTo((screenWidth() - 48) * 9 / 16)
                }
                
                // 内容
                contentLabel.snp.updateConstraints { (make) in
                    make.top.equalTo(coverImage.snp.bottom).offset(12)
                }
                
                // 显示更多
                showMoreView.isHidden = true
                showMoreView.snp.updateConstraints { (make) in
                    make.top.equalTo(contentLabel.snp.bottom).offset(7)
                    make.height.equalTo(0)
                }
                
            } else {
                
                // 清空图片
                coverImage.image = nil
                
                // 更新高度
                coverImage.snp.updateConstraints { (make) in
                    make.height.equalTo(0)
                }
                
                // 内容
                contentLabel.snp.updateConstraints { (make) in
                    make.top.equalTo(coverImage.snp.bottom).offset(0)
                }
                
                // 显示更多
                showMoreView.isHidden = false
                showMoreView.snp.updateConstraints { (make) in
                    make.top.equalTo(contentLabel.snp.bottom).offset(17)
                    make.height.equalTo(37)
                }
                
            }
        }
    }
    
    // 时间
    lazy var timeLabel: INNOUILabel = {
        var view = INNOUILabel()
        view.font = INNOSystemFont(ofSize: 12)
        view.backgroundColor = RGBA(r:212, g:212, b:212, a:1)
        view.textColor = UIColor.white
        view.layer.cornerRadius = 3
        view.paddingLeft = 8
        view.paddingRight = 8
        view.paddingTop = 4
        view.paddingBottom = 4
        view.layer.masksToBounds = true
        view.sizeToFit()
        return view
    }()
    
    // 标题
    lazy var titleLabel: UILabel = {
        var view = UILabel()
        view.font = INNOSystemFont(ofSize: 15)
        view.sizeToFit()
        view.textColor = RGBA(r:40, g:40, b:40, a:1)
        return view
    }()
    
    // 图片
    lazy var coverImage : UIImageView = {
        let view = UIImageView()
        view.backgroundColor = DEFAULT_BACKGROUND_CLR
        return view
    }()
    
    // 内容
    lazy var contentLabel: INNOUILabel = {
        var view = INNOUILabel()
        view.font = INNOSystemFont(ofSize: 13)
        view.lineBreakMode = .byWordWrapping
        view.textColor = RGBA(r:102, g:102, b:102, a:1)
        view.numberOfLines = 0
        view.sizeToFit()
        return view
    }()
    
    /// 查看更多详情
    lazy var showMoreView: MessageShowMoreView = {
        let view = MessageShowMoreView()
        view.backgroundColor = UIColor.white
        return view
    }()
    
    required init?(coder aDecoder: NSCoder) {
        super.init(coder: aDecoder)
    }
    
    override init(style: UITableViewCellStyle, reuseIdentifier: String?) {
        super.init(style: style, reuseIdentifier: reuseIdentifier)
        self.setUpSubviews()
        
    }
    
    func setUpSubviews() {
        
        self.contentView.backgroundColor = DEFAULT_BACKGROUND_CLR
        
        self.contentView.addSubview(timeLabel)
        timeLabel.snp.makeConstraints({(make) in
            make.top.equalTo(20)
            make.height.equalTo(20)
            make.centerX.equalTo(contentView)
        })
        
        let myBackgroundView = UIView()
        myBackgroundView.backgroundColor = UIColor.white
        myBackgroundView.layer.borderWidth = 0.5
        myBackgroundView.layer.borderColor = SPLIT_LINE_CLR.cgColor
        self.contentView.addSubview(myBackgroundView)
        myBackgroundView.snp.makeConstraints({(make) in
            make.top.equalTo(timeLabel.snp.bottom).offset(12)
            make.left.equalTo(12)
            make.right.equalTo(-12)
            make.bottom.equalTo(0)
        })
        
        myBackgroundView.addSubview(titleLabel)
        titleLabel.snp.makeConstraints({(make) in
            make.top.equalTo(16)
            make.left.equalTo(12)
            make.right.equalTo(-12)
        })
        
        myBackgroundView.addSubview(coverImage)
        coverImage.snp.makeConstraints { (make) in
            make.top.equalTo(titleLabel.snp.bottom).offset(16)
            make.left.right.equalTo(titleLabel)
            make.height.equalTo(0)
        }
        
        myBackgroundView.addSubview(contentLabel)
        contentLabel.snp.makeConstraints({(make) in
            make.top.equalTo(coverImage.snp.bottom).offset(12)
            make.left.right.equalTo(titleLabel)
        })
        
        // 查看更多
        myBackgroundView.addSubview(showMoreView)
        showMoreView.snp.makeConstraints { (make) in
            make.top.equalTo(contentLabel.snp.bottom).offset(17)
            make.left.equalTo(12)
            make.right.equalTo(-12)
            make.height.equalTo(0)
            make.bottom.equalTo(0)
        }
        
    }
    
}

/// 查看更多
class MessageShowMoreView: UIView {
    
    override init(frame: CGRect) {
        super.init(frame: frame)
        
        let horizontalLine = UIView()  // 横向分割线
        horizontalLine.backgroundColor = SPLIT_LINE_CLR
        self.addSubview(horizontalLine)
        horizontalLine.snp.makeConstraints({(make) in
            make.left.right.equalTo(0)
            make.top.equalTo(0)
            make.height.equalTo(0.5)
        })
        
        // 查看详情
        let detailLabel = UILabel()
        detailLabel.text = "查看详情"
        detailLabel.font = INNOSystemFont(ofSize: 12)
        detailLabel.textColor = RGBA(r:153, g:153, b:153, a:1)
        self.addSubview(detailLabel)
        detailLabel.snp.makeConstraints({(make) in
            make.left.equalTo(0)
            make.centerY.equalTo(self)
        })
        
        // 右边箭头
        let rightArrowImageView = UIImageView()
        rightArrowImageView.image = UIImage(named: "ico_arrow")
        self.addSubview(rightArrowImageView)
        rightArrowImageView.snp.makeConstraints({(make) in
            make.right.equalTo(0)
            make.centerY.equalTo(self)
        })
        
    }
    
    required init?(coder aDecoder: NSCoder) {
        super.init(coder: aDecoder)
    }
    
}
